{"version":3,"file":"index-da35a739.js","sources":["../../../resources/js/hooks/use-table.js","../../../resources/js/views/error-log/index.vue"],"sourcesContent":["import { ref } from \"vue\";\r\nimport momentMini from \"moment-mini\";\r\nimport { elConfirm, elMessage } from \"./use-element\";\r\nimport axiosReq from \"@/utils/axios-req\";\r\nexport const useTable = (searchForm, selectPageReq) => {\r\n    /*define ref*/\r\n    const tableListData = ref([]);\r\n    const totalPage = ref(0);\r\n    const pageNum = ref(1);\r\n    const pageSize = ref(20);\r\n\r\n    //列表请求\r\n    const tableListReq = (config) => {\r\n        const data = Object.assign(\r\n            {\r\n                pageNum: pageNum.value,\r\n                pageSize: pageSize.value,\r\n            },\r\n            JSON.parse(JSON.stringify(searchForm))\r\n        );\r\n        Object.keys(data).forEach((fItem) => {\r\n            if ([\"\", null, undefined, Number.NaN].includes(data[fItem]))\r\n                delete data[fItem];\r\n            if (config.method === \"get\") {\r\n                if (Array.isArray(data[fItem])) delete data[fItem];\r\n                if (data[fItem] instanceof Object) delete data[fItem];\r\n            }\r\n        });\r\n        const reqConfig = {\r\n            data,\r\n            ...config,\r\n        };\r\n        return axiosReq(reqConfig);\r\n    };\r\n\r\n    /**\r\n     * 日期范围选择处理\r\n     * @param timeArr choose the time\r\n     * @author 熊猫哥\r\n     * @date 2022/9/25 14:02\r\n     */\r\n    const dateRangePacking = (timeArr) => {\r\n        if (timeArr && timeArr.length === 2) {\r\n            searchForm.startTime = timeArr[0];\r\n            //取今天23点\r\n            if (searchForm.endTime) {\r\n                searchForm.endTime = momentMini(timeArr[1])\r\n                    .endOf(\"day\")\r\n                    .format(\"YYYY-MM-DD HH:mm:ss\");\r\n            }\r\n        } else {\r\n            searchForm.startTime = \"\";\r\n            searchForm.endTime = \"\";\r\n        }\r\n    };\r\n    //当前页\r\n    const handleCurrentChange = (val) => {\r\n        pageNum.value = val;\r\n        selectPageReq();\r\n    };\r\n    const handleSizeChange = (val) => {\r\n        pageSize.value = val;\r\n        selectPageReq();\r\n    };\r\n    const resetPageReq = () => {\r\n        pageNum.value = 1;\r\n        selectPageReq();\r\n    };\r\n\r\n    /*多选*/\r\n    const multipleSelection = ref([]);\r\n    const handleSelectionChange = (val) => {\r\n        multipleSelection.value = val;\r\n    };\r\n    /*批量删除*/\r\n    const multiDelBtnDill = (reqConfig) => {\r\n        let rowDeleteIdArr = [];\r\n        let deleteNameTitle = \"\";\r\n        rowDeleteIdArr = multipleSelection.value.map((mItem) => {\r\n            deleteNameTitle = `${deleteNameTitle + mItem.id},`;\r\n            return mItem.id;\r\n        });\r\n        if (rowDeleteIdArr.length === 0) {\r\n            elMessage(\"selection is required\", \"warning\");\r\n            return;\r\n        }\r\n        const stringLength = deleteNameTitle.length - 1;\r\n        elConfirm(\r\n            \"delete\",\r\n            `Are you confirm to delete 【${deleteNameTitle.slice(\r\n                0,\r\n                stringLength\r\n            )}】 ?`\r\n        ).then(() => {\r\n            const data = rowDeleteIdArr;\r\n            axiosReq({\r\n                data,\r\n                method: \"DELETE\",\r\n                bfLoading: true,\r\n                ...reqConfig,\r\n            }).then(() => {\r\n                elMessage(\"Delete Success\");\r\n                resetPageReq();\r\n            });\r\n        });\r\n    };\r\n    //单个删除\r\n    const tableDelDill = (row, reqConfig) => {\r\n        elConfirm(\"Confirm\", `Are you sure to delete【${row.id}】?`).then(\r\n            () => {\r\n                axiosReq(reqConfig).then(() => {\r\n                    resetPageReq();\r\n                    elMessage(`【${row.id}】delete success`);\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    return {\r\n        pageNum,\r\n        pageSize,\r\n        totalPage,\r\n        tableListData,\r\n        tableListReq,\r\n        dateRangePacking,\r\n        multipleSelection,\r\n        handleSelectionChange,\r\n        handleCurrentChange,\r\n        handleSizeChange,\r\n        resetPageReq,\r\n        multiDelBtnDill,\r\n        tableDelDill,\r\n    };\r\n};\r\n","<template>\r\n  <div class=\"mt-10px query-page-style\">\r\n    <!--条件搜索-->\r\n    <el-form ref=\"refSearchForm\" :inline=\"true\" :model=\"searchForm\">\r\n      <el-form-item prop=\"log\">\r\n        <el-input v-model=\"searchForm.log\" class=\"w-150px\" placeholder=\"log\" />\r\n      </el-form-item>\r\n      <el-form-item prop=\"pageUrl\">\r\n        <el-input v-model=\"searchForm.pageUrl\" class=\"w-200px\" placeholder=\"pageUrl\" />\r\n      </el-form-item>\r\n      <el-form-item prop=\"startEndArr\">\r\n        <el-date-picker\r\n          v-model=\"searchForm.startEndArr\"\r\n          type=\"daterange\"\r\n          format=\"YYYY-MM-DD\"\r\n          value-format=\"YYYY-MM-DD HH:mm:ss\"\r\n          class=\"w-250px\"\r\n          range-separator=\"-\"\r\n          start-placeholder=\"startDate\"\r\n          end-placeholder=\"endDate\"\r\n          @change=\"dateRangePacking\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"resetPageReq\">search</el-button>\r\n        <el-button type=\"primary\" @click=\"resetForm\">reset</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <div class=\"rowES mb-10px\">\r\n      <el-button type=\"primary\" @click=\"multiDelBtnClick\">\r\n        <!--        <el-icon style=\"vertical-align: middle\">-->\r\n        <!--          <Delete />-->\r\n        <!--        </el-icon>-->\r\n        <span style=\"vertical-align: middle\">multiDel</span>\r\n      </el-button>\r\n    </div>\r\n    <!--表格和分页-->\r\n    <el-table\r\n      id=\"resetElementDialog\"\r\n      ref=\"refuserTable\"\r\n      :height=\"`calc(100vh - 260px)`\"\r\n      border\r\n      :data=\"tableListData\"\r\n      @selection-change=\"handleSelectionChange\"\r\n    >\r\n      <el-table-column type=\"selection\" align=\"center\" width=\"50\" />\r\n      <el-table-column align=\"center\" prop=\"errorLog\" label=\"Log\" min-width=\"250\">\r\n        <template #default=\"{ row }\">\r\n          <div class=\"btn-click-style\" @click=\"copyValueToClipboard(row.errorLog)\">{{ row.errorLog }}}</div>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"pageUrl\" label=\"Page URL\" min-width=\"120\" />\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"version\" label=\"Version\" min-width=\"80\" />\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"browserType\" label=\"Browser\" min-width=\"120\" />\r\n      <el-table-column show-overflow-tooltip align=\"center\" prop=\"createTime\" label=\"Created At\" min-width=\"120\" />\r\n      <!--点击操作-->\r\n      <el-table-column fixed=\"right\" align=\"center\" label=\"Action\" width=\"72\">\r\n        <template #default=\"{ row }\">\r\n          <div class=\"table-operation-btn\">\r\n            <span @click=\"tableDelClick(row)\">Delete</span>\r\n          </div>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!--分页-->\r\n    <div v-if=\"totalPage >= 10\" class=\"rowCC mt-20px\">\r\n      <el-pagination\r\n        :current-page=\"pageNum\"\r\n        :page-sizes=\"[10, 20, 50, 100]\"\r\n        :page-size=\"pageSize\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n        :total=\"totalPage\"\r\n        @size-change=\"handleSizeChange\"\r\n        @current-change=\"handleCurrentChange\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n<script setup lang=\"ts\" name=\"error-collection\">\r\n//import { Delete, FolderAdd } from '@element-plus/icons-vue'\r\nimport { reactive, ref, onMounted } from 'vue';\r\nimport { useTable } from '@/hooks/use-table'\r\nimport { copyValueToClipboard } from '@/hooks/use-common'\r\nconst searchForm = reactive({\r\n  log: '',\r\n  pageUrl: '',\r\n  startEndArr: ''\r\n})\r\nconst selectPageReq = () => {\r\n  const reqConfig = {\r\n    url: '/integration-front/errorCollection/selectPage',\r\n    method: 'get'\r\n  }\r\n  tableListReq(reqConfig).then(({ data }) => {\r\n    tableListData.value = data.records\r\n    totalPage.value = data.total\r\n  })\r\n}\r\n//重置\r\nconst refSearchForm = ref()\r\nconst resetForm = () => {\r\n  refSearchForm.value.resetFields()\r\n  dateRangePacking(['', ''])\r\n  resetPageReq()\r\n}\r\n\r\n//批量删除\r\nconst multiDelBtnClick = () => {\r\n  const reqConfig = {\r\n    url: '/integration-front/errorCollection/deleteBatchIds',\r\n    method: 'delete',\r\n    bfLoading: true\r\n  }\r\n  multiDelBtnDill(reqConfig)\r\n}\r\n\r\n//单个删除\r\nconst tableDelClick = (row) => {\r\n  const reqConfig = {\r\n    url: '/integration-front/errorCollection/deleteById',\r\n    params: { id: row.id },\r\n    method: 'delete'\r\n  }\r\n  tableDelDill(row, reqConfig)\r\n}\r\n\r\n//添加和修改详情\r\nonMounted(() => {\r\n  selectPageReq()\r\n})\r\n\r\n//引入table-query相关的hooks 方法\r\nlet {\r\n  pageNum,\r\n  pageSize,\r\n  totalPage,\r\n  tableListData,\r\n  tableListReq,\r\n  dateRangePacking,\r\n  handleSelectionChange,\r\n  handleCurrentChange,\r\n  handleSizeChange,\r\n  resetPageReq,\r\n  multiDelBtnDill,\r\n  tableDelDill\r\n} = useTable(searchForm, selectPageReq)\r\n</script>\r\n\r\n<style scoped lang=\"scss\"></style>\r\n"],"names":["useTable","searchForm","selectPageReq","tableListData","ref","totalPage","pageNum","pageSize","tableListReq","config","data","fItem","reqConfig","axiosReq","dateRangePacking","timeArr","momentMini","handleCurrentChange","val","handleSizeChange","resetPageReq","multipleSelection","rowDeleteIdArr","deleteNameTitle","mItem","elMessage","stringLength","elConfirm","row","reactive","refSearchForm","resetForm","multiDelBtnClick","multiDelBtnDill","tableDelClick","tableDelDill","onMounted","handleSelectionChange"],"mappings":"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"}